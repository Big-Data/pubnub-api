(function(){
window.JSON&&window.JSON.stringify||function(){function r(c){u.lastIndex=0;return u.test(c)?'"'+c.replace(u,function(c){var d=D[c];return"string"===typeof d?d:"\\u"+("0000"+c.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+c+'"'}function n(m,p){var d,j,i,o,t=c,k,f=p[m];f&&("object"===typeof f&&"function"===typeof f.toJSON)&&(f=f.toJSON(m));"function"===typeof h&&(f=h.call(p,m,f));switch(typeof f){case "string":return r(f);case "number":return isFinite(f)?String(f):"null";case "boolean":case "null":return String(f);
case "object":if(!f)return"null";c+=g;k=[];if("[object Array]"===Object.prototype.toString.apply(f)){o=f.length;for(d=0;d<o;d+=1)k[d]=n(d,f)||"null";i=0===k.length?"[]":c?"[\n"+c+k.join(",\n"+c)+"\n"+t+"]":"["+k.join(",")+"]";c=t;return i}if(h&&"object"===typeof h){o=h.length;for(d=0;d<o;d+=1)j=h[d],"string"===typeof j&&(i=n(j,f))&&k.push(r(j)+(c?": ":":")+i)}else for(j in f)Object.hasOwnProperty.call(f,j)&&(i=n(j,f))&&k.push(r(j)+(c?": ":":")+i);i=0===k.length?"{}":c?"{\n"+c+k.join(",\n"+c)+"\n"+
t+"}":"{"+k.join(",")+"}";c=t;return i}}window.JSON||(window.JSON={});"function"!==typeof String.prototype.toJSON&&(String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var u=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c,g,D={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h;"function"!==typeof JSON.stringify&&(JSON.stringify=function(m,
p,d){var j;g=c="";if(typeof d==="number")for(j=0;j<d;j=j+1)g=g+" ";else typeof d==="string"&&(g=d);if((h=p)&&typeof p!=="function"&&(typeof p!=="object"||typeof p.length!=="number"))throw Error("JSON.stringify");return n("",{"":m})});"function"!==typeof JSON.parse&&(JSON.parse=function(c){return eval("("+c+")")})}();
window.PUBNUB||function(){function r(){return"x"+ ++S+""+ +new Date}function n(){return+new Date}function u(a,b){var e,c=0,f=function(){c+b>n()?(clearTimeout(e),e=setTimeout(f,b)):(c=n(),a())};return f}function c(a){return document.getElementById(a)}function g(a){console.log(a)}function D(a,b){var e=[];h(a.split(/\s+/),function(a){h((b||document).getElementsByTagName(a),function(a){e.push(a)})});return e}function h(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var e=0,c=a.length;e<c;)b.call(a[e],a[e],
e++);else for(e in a)a.hasOwnProperty&&a.hasOwnProperty(e)&&b.call(a[e],e,a[e])}function m(a,b){var e=[];h(a||[],function(a,c){e.push(b(a,c))});return e}function p(a,b){return a.replace(T,function(a,c){return b[c]||a})}function d(a,b,e){h(a.split(","),function(a){var c=function(a){a||(a=window.event);e(a)||(a.cancelBubble=!0,a.returnValue=!1,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())};b.addEventListener?b.addEventListener(a,c,!1):b.attachEvent?b.attachEvent("on"+
a,c):b["on"+a]=c})}function j(){return D("head")[0]}function i(a,b,c){if(c)a.setAttribute(b,c);else return a&&a.getAttribute&&a.getAttribute(b)}function o(a,b){for(var c in b)if(b.hasOwnProperty(c))try{a.style[c]=b[c]+(0<"|width|height|top|left|".indexOf(c)&&"number"==typeof b[c]?"px":"")}catch(f){}}function t(a){return document.createElement(a)}function k(){return F||l()?0:r()}function f(a){return m(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}
function v(a){if(F||l()){a:{var b,e=function(){if(!d){d=1;clearTimeout(g);try{response=JSON.parse(b.responseText)}catch(a){return y(1)}h(response)}},f=0,d=0,g=setTimeout(function(){y(1)},G),k=a.fail||function(){},h=a.success||function(){},y=function(a){f||(f=1,clearTimeout(g),b&&(b.onerror=b.onload=null,b.abort&&b.abort(),b=null),a&&k())};try{b=l()||window.XDomainRequest&&new XDomainRequest||new XMLHttpRequest;b.onerror=b.onabort=function(){y(1)};b.onload=b.onloadend=e;b.timeout=G;url=a.url.join(L);
if(a.data)for(key in url+="?",a.data)url+=key+"="+a.data[key]+"&";b.open("GET",url,!0);b.send()}catch(V){y(0);F=0;a=v(a);break a}a=y}return a}var q=t("script"),e=a.callback,M=r(),N=0,U=setTimeout(function(){m(1)},G),p=a.fail||function(){},n=a.success||function(){},m=function(a,b){N||(N=1,a||n(b),q.onerror=null,clearTimeout(U),setTimeout(function(){a&&p();var b=c(M),q=b&&b.parentNode;q&&q.removeChild(b)},B))};window[e]=function(a){m(0,a)};q[O]=O;q.onerror=function(){m(1)};q.src=a.url.join(L);if(a.data)for(key in q.src+=
"?",a.data)q.src+=key+"="+a.data[key]+"&";i(q,"id",M);j().appendChild(q);return m}function H(){PUBNUB.time(n);PUBNUB.time(function(){setTimeout(function(){I||(I=1,h(P,function(a){a[2].subscribe(a[0],a[1])}))},B)})}function l(){if(!Q.get)return 0;var a={id:l.id++,send:function(){},abort:function(){a.id={}},open:function(b,c){l[a.id]=a;Q.get(a.id,c)}};return a}window.console||(window.console=window.console||{});console.log||(console.log=(window.opera||{}).postError||function(){});var w,E=window.localStorage;
w={get:function(a){try{return E?E.getItem(a):-1==document.cookie.indexOf(a)?null:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||null}catch(b){}},set:function(a,b){try{if(E)return E.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(c){}}};var S=1,T=/{([\w\-]+)}/g,O="async",L="/",G=31E4,B=1E3,F=-1==navigator.userAgent.indexOf("MSIE 6"),J,K=Math.floor(9*Math.random())+1;J=function(a){return 0<a.indexOf("pubsub")&&a.replace("pubsub","ps"+(10>++K?
K:K=1))||a};var C={list:{},unbind:function(a){C.list[a]=[]},bind:function(a,b){(C.list[a]=C.list[a]||[]).push(b)},fire:function(a,b){h(C.list[a]||[],function(a){a(b)})}},s=c("pubnub")||{},I=0,P=[],R=function(a){var b={},e=a.publish_key||"",l=a.subscribe_key||"",s=a.ssl?"s":"",x=a.uuid||w.get(l+"uuid")||"",A="http"+s+"://"+(a.origin||"pubsub.pubnub.com"),z={history:function(a,b){var b=a.callback||b,c=a.limit||100,e=a.channel,d=k();if(!e)return g("Missing Channel");if(!b)return g("Missing Callback");
v({callback:d,url:[A,"history",l,f(e),d,c],success:function(a){b(a)},fail:function(a){g(a)}})},time:function(a){var b=k();v({callback:b,url:[A,"time",b],success:function(b){a(b[0])},fail:function(){a(0)}})},uuid:function(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b},publish:function(a,b){var b=b||a.callback||function(){},c=a.message,d=a.channel,h=k();if(!c)return g("Missing Message");if(!d)return g("Missing Channel");
if(!e)return g("Missing Publish Key");c=JSON.stringify(c);c=[A,"publish",e,l,0,f(d),h,f(c)];v({callback:h,success:function(a){b(a)},fail:function(){b([0,"Disconnected"])},url:c,data:{uuid:x}})},unsubscribe:function(a){function c(a){a in b&&(b[a].connected=0,b[a].done&&b[a].done(0))}c(a.channel);c(a.channel+"-pnpres")},subscribe:function(a,c){var d=a.channel,c=c||a.callback,e=a.subscribe_key||l,i=a.restore,j=0,m=a.error||function(){},p=a.connect||function(){},n=a.reconnect||function(){},s=a.disconnect||
function(){},r=a.presence||function(){},o=0,t=0,u=J(A);if(!I)return P.push([a,c,z]);if(!d)return g("Missing Channel");if(!c)return g("Missing Callback");if(!l)return g("Missing Subscribe Key");d in b||(b[d]={});if(b[d].connected)return g("Already Connected");b[d].connected=1;a.presence&&z.subscribe({channel:a.channel+"-pnpres",callback:r,restore:a.restore});r=k();b[d].connected&&(b[d].done=v({callback:r,url:[u,"subscribe",e,f(d),r,j],data:{uuid:x},fail:function(){o||(o=1,s());setTimeout(pubnub,B);
z.time(function(a){if(a&&o){o=0;n()}else m()})},success:function(a){b[d].connected&&(t||(t=1,p()),o&&(o=0,n()),i=w.set(l+d,j=i&&w.get(e+d)||a[1]),h(a[0],function(b){c(b,a)}),setTimeout(pubnub,10))}}))},here_now:function(a,b){var b=a.callback||b,c=a.channel,d=k(),e=J(A);if(!c)return g("Missing Channel");if(!b)return g("Missing Callback");data=null;"0"!=d&&(data.callback=d);v({callback:d,url:[e,"v2","presence","sub_key",l,"channel",f(c)],data:data,success:function(a){b(a)},fail:function(a){g(a)}})},
xdr:v,ready:H,db:w,each:h,map:m,css:o,$:c,create:t,bind:d,supplant:p,head:j,search:D,attr:i,now:n,unique:r,events:C,updater:u,init:R};""==x&&(x=z.uuid());w.set(l+"uuid",x);return z};PUBNUB=R({publish_key:i(s,"pub-key"),subscribe_key:i(s,"sub-key"),ssl:"on"==i(s,"ssl"),origin:i(s,"origin"),uuid:i(s,"uuid")});o(s,{position:"absolute",top:-B});if("opera"in window||i(s,"flash"))s.innerHTML="<object id=pubnubs data=https://dh15atwfs066y.cloudfront.net/pubnub.swf><param name=movie value=https://dh15atwfs066y.cloudfront.net/pubnub.swf><param name=allowscriptaccess value=always></object>";
var Q=c("pubnubs")||{};d("load",window,function(){setTimeout(H,0)});PUBNUB.rdx=function(a,b){if(!b)return l[a].onerror();l[a].responseText=unescape(b);l[a].onload()};l.id=B;window.jQuery&&(window.jQuery.PUBNUB=PUBNUB);"undefined"!==typeof module&&(module.exports=PUBNUB)&&H()}();
})();
