window.JSON&&window.JSON.stringify||function(){function v(c){y.lastIndex=0;return y.test(c)?'"'+c.replace(y,function(c){var d=G[c];return"string"===typeof d?d:"\\u"+("0000"+c.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+c+'"'}function t(l,q){var d,j,u,n,r=h,o,e=q[l];e&&("object"===typeof e&&"function"===typeof e.toJSON)&&(e=e.toJSON(l));"function"===typeof g&&(e=g.call(q,l,e));switch(typeof e){case "string":return v(e);case "number":return isFinite(e)?String(e):"null";case "boolean":case "null":return String(e);
case "object":if(!e)return"null";h+=c;o=[];if("[object Array]"===Object.prototype.toString.apply(e)){n=e.length;for(d=0;d<n;d+=1)o[d]=t(d,e)||"null";u=0===o.length?"[]":h?"[\n"+h+o.join(",\n"+h)+"\n"+r+"]":"["+o.join(",")+"]";h=r;return u}if(g&&"object"===typeof g){n=g.length;for(d=0;d<n;d+=1)j=g[d],"string"===typeof j&&(u=t(j,e))&&o.push(v(j)+(h?": ":":")+u)}else for(j in e)Object.hasOwnProperty.call(e,j)&&(u=t(j,e))&&o.push(v(j)+(h?": ":":")+u);u=0===o.length?"{}":h?"{\n"+h+o.join(",\n"+h)+"\n"+
r+"}":"{"+o.join(",")+"}";h=r;return u}}window.JSON||(window.JSON={});"function"!==typeof String.prototype.toJSON&&(String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var y=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h,c,G={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},g;"function"!==typeof JSON.stringify&&(JSON.stringify=function(l,
q,d){var j;c=h="";if(typeof d==="number")for(j=0;j<d;j=j+1)c=c+" ";else typeof d==="string"&&(c=d);if((g=q)&&typeof q!=="function"&&(typeof q!=="object"||typeof q.length!=="number"))throw Error("JSON.stringify");return t("",{"":l})});"function"!==typeof JSON.parse&&(JSON.parse=function(c){return eval("("+c+")")})}();
window.PUBNUB||function(){function v(){return"x"+ ++X+""+ +new Date}function t(){return+new Date}function y(a,b){var f,m=0,c=function(){m+b>t()?(clearTimeout(f),f=setTimeout(c,b)):(m=t(),a())};return c}function h(a){return document.getElementById(a)}function c(a){console.log(a)}function G(a,b){var f=[];g(a.split(/\s+/),function(a){g((b||document).getElementsByTagName(a),function(a){f.push(a)})});return f}function g(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var f=0,c=a.length;f<c;)b.call(a[f],a[f],
f++);else for(f in a)a.hasOwnProperty&&a.hasOwnProperty(f)&&b.call(a[f],f,a[f])}function l(a,b){var f=[];g(a||[],function(a,c){f.push(b(a,c))});return f}function q(a,b){var f=[];g(a||[],function(a){b(a)&&f.push(a)});return f}function d(a,b){return a.replace(Y,function(a,c){return b[c]||a})}function j(a,b,c){g(a.split(","),function(a){var e=function(a){a||(a=window.event);c(a)||(a.cancelBubble=!0,a.returnValue=!1,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())};b.addEventListener?
b.addEventListener(a,e,!1):b.attachEvent?b.attachEvent("on"+a,e):b["on"+a]=e})}function u(){return G("head")[0]}function n(a,b,c){if(c)a.setAttribute(b,c);else return a&&a.getAttribute&&a.getAttribute(b)}function r(a,b){for(var c in b)if(b.hasOwnProperty(c))try{a.style[c]=b[c]+(0<"|width|height|top|left|".indexOf(c)&&"number"==typeof b[c]?"px":"")}catch(e){}}function o(a){return document.createElement(a)}function e(){return I||p()?0:v()}function z(a){return l(encodeURIComponent(a).split(""),function(a){return 0>
"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function x(a){if(I||p()){a:{var b,c,e=function(){if(!j){j=1;clearTimeout(g);try{c=JSON.parse(b.responseText)}catch(a){return C(1)}Z(c)}},d=0,j=0,g=setTimeout(function(){C(1)},J),q=a.fail||function(){},Z=a.success||function(){},C=function(a){d||(d=1,clearTimeout(g),b&&(b.onerror=b.onload=null,b.abort&&b.abort(),b=null),a&&q())};try{b=p()||window.XDomainRequest&&new XDomainRequest||new XMLHttpRequest;b.onerror=b.onabort=
function(){C(1)};b.onload=b.onloadend=e;b.timeout=J;var i=a.url.join(P);if(a.data){var e=[],K,i=i+"?";for(K in a.data)e.push(K+"="+a.data[K]);i+=e.join(Q)}b.open("GET",i,!0);b.send()}catch(k){C(0);I=0;a=x(a);break a}a=C}return a}var w=o("script"),i=a.callback,R=v(),S=0,t=setTimeout(function(){r(1)},J),l=a.fail||function(){},s=a.success||function(){},r=function(a,b){S||(S=1,a||s(b),w.onerror=null,clearTimeout(t),setTimeout(function(){a&&l();var b=h(R),c=b&&b.parentNode;c&&c.removeChild(b)},E))};window[i]=
function(a){r(0,a)};w[T]=T;w.onerror=function(){r(1)};w.src=a.url.join(P);if(a.data){i=[];w.src+="?";for(key in a.data)i.push(key+"="+a.data[key]);w.src+=i.join(Q)}n(w,"id",R);u().appendChild(w);return r}function L(){PUBNUB.time(t);PUBNUB.time(function(){setTimeout(function(){M||(M=1,g(U,function(a){a[2].subscribe(a[0],a[1])}))},E)})}function p(){if(!V.get)return 0;var a={id:p.id++,send:function(){},abort:function(){a.id={}},open:function(b,c){p[a.id]=a;V.get(a.id,c)}};return a}window.console||(window.console=
window.console||{});console.log||(console.log=(window.opera||{}).postError||function(){});var B,H=window.localStorage;B={get:function(a){try{return H?H.getItem(a):-1==document.cookie.indexOf(a)?null:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||null}catch(b){}},set:function(a,b){try{if(H)return H.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(c){}}};var X=1,Y=/{([\w\-]+)}/g,T="async",P="/",Q="&",J=31E4,E=1E3,I=-1==navigator.userAgent.indexOf("MSIE 6"),
N,O=Math.floor(9*Math.random())+1;N=function(a){return 0<a.indexOf("pubsub")&&a.replace("pubsub","ps"+(10>++O?O:O=1))||a};var F={list:{},unbind:function(a){F.list[a]=[]},bind:function(a,b){(F.list[a]=F.list[a]||[]).push(b)},fire:function(a,b){g(F.list[a]||[],function(a){a(b)})}},s=h("pubnub")||{},M=0,U=[],W=function(a){var b={},f=a.publish_key||"",m=a.subscribe_key||"",s=a.ssl?"s":"",p=a.uuid||B.get(m+"uuid")||"",A="http"+s+"://"+(a.origin||"pubsub.pubnub.com"),D={history:function(a,b){var b=a.callback||
b,i=a.limit||100,d=a.channel,k=e();if(!d)return c("Missing Channel");if(!b)return c("Missing Callback");if(!m)return c("Missing Subscribe Key");x({success:function(a){b(a)},fail:function(a){c(a)},callback:k,url:[A,"history",m,z(d),k,i]})},detailedHistory:function(a,b){var b=a.callback||b,i=a.count||100,d=a.reverse||"false",k=a.channel,f=a.start,j=a.end,g={},h=e();if(!k)return c("Missing Channel");if(!b)return c("Missing Callback");if(!m)return c("Missing Subscribe Key");g.count=i;g.reverse=d;f&&(g.start=
f);j&&(g.end=j);x({callback:h,data:g,success:function(a){b(a)},fail:function(a){c(a)},url:[A,"v2","history","sub-key",m,"channel",z(k)]})},time:function(a){var b=e();x({callback:b,url:[A,"time",b],success:function(b){a(b[0])},fail:function(){a(0)}})},uuid:function(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b},publish:function(a,b){var b=b||a.callback||function(){},i=a.message,d=a.channel,
g=e();if(!i)return c("Missing Message");if(!d)return c("Missing Channel");if(!f)return c("Missing Publish Key");if(!m)return c("Missing Subscribe Key");i=JSON.stringify(i);i=[A,"publish",f,m,0,z(d),g,z(i)];x({callback:g,success:function(a){b(a)},fail:function(){b([0,"Disconnected"])},url:i,data:{uuid:p}})},unsubscribe:function(a){function c(a){a in b&&(b[a].connected=0,b[a].done&&b[a].done(0))}c(a.channel);c(a.channel+"-pnpres")},subscribe:function(a,d){function i(){var a=e();b[k].connected&&(b[k].done=
x({callback:a,data:{uuid:p},url:[y,"subscribe",h,z(k),a,o],fail:function(){l||(l=1,t(),f());setTimeout(i,E);D.time(function(a){if(a&&l){l=0;q()}else r()})},success:function(a){b[k].connected&&(v||(v=1,s()),l&&(l=0,q()),n=B.set(m+k,o=n&&B.get(h+k)||a[1]),g(a[0],function(b){d(b,a)}),setTimeout(i,10))}}))}function f(){var a={uuid:p},b=e();"0"!=b&&(a.callback=b);x({callback:b,data:a,url:[y,"v2","presence","sub_key",m,"channel",z(k),"leave"]});return!0}var k=a.channel,d=d||a.callback,h=a.subscribe_key||
m,n=a.restore,o=0,r=a.error||function(){},s=a.connect||function(){},q=a.reconnect||function(){},t=a.disconnect||function(){},u=a.presence||function(){},l=0,v=0,y=N(A);if(!M)return U.push([a,d,D]);if(!k)return c("Missing Channel");if(!d)return c("Missing Callback");if(!m)return c("Missing Subscribe Key");k in b||(b[k]={});if(b[k].connected)return c("Already Connected");b[k].connected=1;j("beforeunload",window,f);a.presence&&D.subscribe({channel:a.channel+"-pnpres",callback:u,restore:a.restore,disconnect:f});
i()},here_now:function(a,b){var b=a.callback||b,d=a.channel,f=e(),g={},h=N(A);if(!d)return c("Missing Channel");if(!b)return c("Missing Callback");if(!m)return c("Missing Subscribe Key");"0"!=f&&(g.callback=f);x({callback:f,data:g,success:function(a){b(a)},fail:function(a){c(a)},url:[h,"v2","presence","sub_key",m,"channel",z(d)]})},xdr:x,ready:L,db:B,each:g,map:l,grep:q,css:r,$:h,create:o,bind:j,supplant:d,head:u,search:G,attr:n,now:t,unique:v,events:F,updater:y,init:W};p||(p=D.uuid());B.set(m+"uuid",
p);return D};PUBNUB=W({publish_key:n(s,"pub-key"),subscribe_key:n(s,"sub-key"),ssl:!document.location.href.indexOf("https")||"on"==n(s,"ssl"),origin:n(s,"origin"),uuid:n(s,"uuid")});r(s,{position:"absolute",top:-E});if("opera"in window||n(s,"flash"))s.innerHTML="<object id=pubnubs data=https://dh15atwfs066y.cloudfront.net/pubnub.swf><param name=movie value=https://dh15atwfs066y.cloudfront.net/pubnub.swf><param name=allowscriptaccess value=always></object>";var V=h("pubnubs")||{};j("load",window,function(){setTimeout(L,
0)});PUBNUB.rdx=function(a,b){if(!b)return p[a].onerror();p[a].responseText=unescape(b);p[a].onload()};p.id=E;window.jQuery&&(window.jQuery.PUBNUB=PUBNUB);"undefined"!==typeof module&&(module.exports=PUBNUB)&&L()}();
