(window.JSON&&window.JSON["stringify"])||(function(){window.JSON||(window.JSON={});if(typeof String.prototype.toJSON!=="function"){String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text){return eval("("+text+")")}}}());window.PUBNUB||(function(){window.console||(window.console=window.console||{});console.log||(console.log=((window.opera||{}).postError||function(){}));function c(){return"x"+ ++o+""+(+new Date)}function B(){return +new Date}var r=(function(){var Q=window.localStorage;return{get:function(R){try{if(Q){return Q.getItem(R)}if(document.cookie.indexOf(R)==-1){return null}return((document.cookie||"").match(RegExp(R+"=([^;]+)"))||[])[1]||null}catch(S){return}},set:function(R,S){try{if(Q){return Q.setItem(R,S)&&0}document.cookie=R+"="+S+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(T){return}}}})();var o=1,m="https://dh15atwfs066y.cloudfront.net/pubnub.swf",F=/{([\w\-]+)}/g,J="async",p="/",z="&",H=310000,g=1000,G="-pnpres",A=navigator.userAgent,a=A.indexOf("MSIE 6")==-1;var t=(function(){var Q=Math.floor(Math.random()*9)+1;return function(R){return R.indexOf("pubsub")>0&&R.replace("pubsub","ps"+(++Q<10?Q:Q=1))||R}})();function O(R,S){var U,T=0,Q=function(){if(T+S>B()){clearTimeout(U);U=setTimeout(Q,S)}else{T=B();R()}};return Q}function D(Q){return document.getElementById(Q)}function h(Q){console.log(Q)}function N(R,S){var Q=[];K(R.split(/\s+/),function(T){K((S||document).getElementsByTagName(T),function(U){Q.push(U)})});return Q}function K(T,S){if(!T||!S){return}if(typeof T[0]!="undefined"){for(var R=0,Q=T.length;R<Q;){S.call(T[R],T[R],R++)}}else{for(var R in T){T.hasOwnProperty&&T.hasOwnProperty(R)&&S.call(T[R],R,T[R])}}}function y(R,Q){var S=[];K(R||[],function(U,T){S.push(Q(U,T))});return S}function P(R,Q){var S=[];K(R||[],function(T){Q(T)&&S.push(T)});return S}function w(R,Q){return R.replace(F,function(T,S){return Q[S]||T})}function f(S,R,Q){K(S.split(","),function(U){var T=function(V){if(!V){V=window.event}if(!Q(V)){V.cancelBubble=true;V.returnValue=false;V.preventDefault&&V.preventDefault();V.stopPropagation&&V.stopPropagation()}};if(R.addEventListener){R.addEventListener(U,T,false)}else{if(R.attachEvent){R.attachEvent("on"+U,T)}else{R["on"+U]=T}}})}function u(S,R,Q){if(R.removeEventListener){R.removeEventListener(S,false)}else{if(R.detachEvent){R.detachEvent("on"+S,false)}else{R["on"+S]=null}}}function q(){return N("head")[0]}function s(R,Q,S){if(S){R.setAttribute(Q,S)}else{return R&&R.getAttribute&&R.getAttribute(Q)}}function I(Q,S){for(var R in S){if(S.hasOwnProperty(R)){try{Q.style[R]=S[R]+("|width|height|top|left|".indexOf(R)>0&&typeof S[R]=="number"?"px":"")}catch(T){}}}}function i(Q){return document.createElement(Q)}function M(Q,R){return setTimeout(Q,R)}function v(){return a||C()?0:c()}function d(Q){return y((encodeURIComponent(Q)).split(""),function(R){return"-_.!~*'()".indexOf(R)<0?R:"%"+R.charCodeAt(0).toString(16).toUpperCase()}).join("")}var x={list:{},unbind:function(Q){x.list[Q]=[]},bind:function(R,Q){(x.list[R]=x.list[R]||[]).push(Q)},fire:function(Q,R){K(x.list[Q]||[],function(S){S(R)})}};function n(U){if(a||C()){return E(U)}var Y=i("script"),Z=U.callback,Q=c(),W=0,R=M(function(){X(1)},H),T=U.fail||function(){},aa=U.success||function(){},S=function(){q().appendChild(Y)},X=function(ab,ac){if(W){return}W=1;ab||aa(ac);Y.onerror=null;clearTimeout(R);M(function(){ab&&T();var ad=D(Q),ae=ad&&ad.parentNode;ae&&ae.removeChild(ad)},g)};window[Z]=function(ab){X(0,ab)};Y[J]=J;Y.onerror=function(){X(1)};Y.src=U.url.join(p);if(U.data){var V=[];Y.src+="?";for(key in U.data){V.push(key+"="+U.data[key])}Y.src+=V.join(z)}s(Y,"id",Q);S();return X}function E(T){var aa,V=function(){if(Y){return}Y=1;clearTimeout(Q);try{response=JSON.parse(aa.responseText)}catch(ab){return W(1)}Z(response)},R=0,Y=0,Q=M(function(){W(1)},H),S=T.fail||function(){},Z=T.success||function(){},W=function(ab){if(R){return}R=1;clearTimeout(Q);if(aa){aa.onerror=aa.onload=null;aa.abort&&aa.abort();aa=null}ab&&S()};try{aa=C()||window.XDomainRequest&&new XDomainRequest()||new XMLHttpRequest();aa.onerror=aa.onabort=function(){W(1)};aa.onload=aa.onloadend=V;aa.timeout=H;url=T.url.join(p);if(T.data){var U=[];url+="?";for(key in T.data){U.push(key+"="+T.data[key])}url+=U.join(z)}aa.open("GET",url,true);aa.send()}catch(X){W(0);a=0;return n(T)}return W}var k=D("pubnub")||{},j=0,b=[],L=function(Q){var V={},T=Q.publish_key||"",S=Q.subscribe_key||"",X=Q.ssl?"s":"",W=Q.uuid||r.get(S+"uuid")||"",R="http"+X+"://"+(Q.origin||"pubsub.pubnub.com"),U={history:function(Z,ac){var ac=Z.callback||ac,Y=Z.limit||100,aa=Z.channel,ab=v();if(!aa){return h("Missing Channel")}if(!ac){return h("Missing Callback")}n({callback:ab,url:[R,"history",S,d(aa),ab,Y],success:function(ad){ac(ad)},fail:function(ad){h(ad)}})},detailedHistory:function(ae,ag){var ag=ae.callback||ag,ab=ae.count||100,ac=ae.channel,ad=ae.reverse||"false",Y=ae.start,aa=ae.end,af=v();if(!ac){return h("Missing Channel")}if(!ag){return h("Missing Callback")}var Z={};Z.count=ab;Z.reverse=ad;if(Y){Z.start=Y}if(aa){Z.end=aa}n({callback:af,url:[R,"v2","history","sub-key",S,"channel",d(ac),],data:Z,success:function(ah){ag(ah)},fail:function(ah){h(ah)}})},time:function(Z){var Y=v();n({callback:Y,url:[R,"time",Y],success:function(aa){Z(aa[0])},fail:function(){Z(0)}})},uuid:function(Z){var Y="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(ac){var ab=Math.random()*16|0,aa=ac=="x"?ab:(ab&3|8);return aa.toString(16)});if(Z){Z(Y)}return Y},publish:function(Z,ad){var ad=ad||Z.callback||function(){},ab=Z.message,aa=Z.channel,ac=v(),Y;if(!ab){return h("Missing Message")}if(!aa){return h("Missing Channel")}if(!T){return h("Missing Publish Key")}ab=JSON.stringify(ab);Y=[R,"publish",T,S,0,d(aa),ac,d(ab)];n({callback:ac,success:function(ae){ad(ae)},fail:function(){ad([0,"Disconnected"])},url:Y,data:{uuid:W}})},unsubscribe:function(Z){Y(Z.channel);Y(Z.channel+G);function Y(aa){if(!(aa in V)){return}V[aa].connected=0;V[aa].done&&V[aa].done(0)}},subscribe:function(ad,al){var ab=ad.channel,al=al||ad.callback,af=ad.subscribe_key||S,ac=ad.restore,ai=0,ae=ad.error||function(){},am=ad.connect||function(){},Y=ad.reconnect||function(){},ak=ad.disconnect||function(){},aa=ad.presence||function(){},ag=0,Z=0,ah=t(R);if(!j){return b.push([ad,al,U])}if(!ab){return h("Missing Channel")}if(!al){return h("Missing Callback")}if(!S){return h("Missing Subscribe Key")}if(!(ab in V)){V[ab]={}}if(V[ab].connected){return h("Already Connected")}V[ab].connected=1;function aj(){var an=v();if(!V[ab].connected){return}V[ab].done=n({callback:an,url:[ah,"subscribe",af,d(ab),an,ai],data:{uuid:W},fail:function(){if(!ag){ag=1;ak()}M(pubnub,g);U.time(function(ao){if(ao&&ag){ag=0;Y()}else{ae()}})},success:function(ao){if(!V[ab].connected){return}if(!Z){Z=1;am()}if(ag){ag=0;Y()}ac=r.set(S+ab,ai=ac&&r.get(af+ab)||ao[1]);K(ao[0],function(ap){al(ap,ao)});M(pubnub,10)}})}if(ad.presence){U.subscribe({channel:ad.channel+G,callback:aa,restore:ad.restore})}aj()},here_now:function(Z,ac){var ac=Z.callback||ac,aa=Z.channel,ab=v(),Y=t(R);if(!aa){return h("Missing Channel")}if(!ac){return h("Missing Callback")}data=null;if(ab!="0"){data.callback=ab}n({callback:ab,url:[Y,"v2","presence","sub_key",S,"channel",d(aa)],data:data,success:function(ad){ac(ad)},fail:function(ad){h(ad)}})},xdr:n,ready:e,db:r,each:K,map:y,css:I,"$":D,create:i,bind:f,supplant:w,head:q,search:N,attr:s,now:B,unique:c,events:x,updater:O,init:L};if(W==""){W=U.uuid()}r.set(S+"uuid",W);return U};PUBNUB=L({publish_key:s(k,"pub-key"),subscribe_key:s(k,"sub-key"),ssl:s(k,"ssl")=="on",origin:s(k,"origin"),uuid:s(k,"uuid")});I(k,{position:"absolute",top:-g});if("opera" in window||s(k,"flash")){k.innerHTML="<object id=pubnubs data="+m+"><param name=movie value="+m+"><param name=allowscriptaccess value=always></object>"}var l=D("pubnubs")||{};function e(){PUBNUB.time(B);PUBNUB.time(function(Q){M(function(){if(j){return}j=1;K(b,function(R){R[2]["subscribe"](R[0],R[1])})},g)})}f("load",window,function(){M(e,0)});PUBNUB.rdx=function(R,Q){if(!Q){return C[R]["onerror"]()}C[R]["responseText"]=unescape(Q);C[R]["onload"]()};function C(){if(!l.get){return 0}var Q={id:C.id++,send:function(){},abort:function(){Q.id={}},open:function(S,R){C[Q.id]=Q;l.get(Q.id,R)}};return Q}C.id=g;window.jQuery&&(window.jQuery["PUBNUB"]=PUBNUB);typeof module!=="undefined"&&(module.exports=PUBNUB)&&e()})();